generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                      String                   @id @default(cuid())
  email                   String                   @unique
  username                String?                  @unique
  password                String?
  name                    String?
  role                    UserRole                 @default(ADMIN)
  createdAt               DateTime                 @default(now())
  updatedAt               DateTime                 @updatedAt
  contacts                Contact[]
  notificationPreferences NotificationPreference[]
  notifications           Notification[]
  teacher                 Teacher?

  @@map("users")
}

model Student {
  id               String        @id @default(cuid())
  name             String
  email            String?       @unique
  phone            String?
  address          String?
  dni              String?       @unique
  birthDate        DateTime?
  isAffiliated     Boolean       @default(false)
  affiliateNumber  String?       @unique
  emergencyContact String?
  emergencyPhone   String?
  medicalInfo      String?
  status           StudentStatus @default(ACTIVE)
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
  contacts         Contact[]
  enrollments      Enrollment[]
  payments         Payment[]

  @@map("students")
}

model Teacher {
  id           String         @id @default(cuid())
  name         String?
  email        String?        @unique
  phone        String?
  address      String?
  dni          String?        @unique
  specialty    String?
  experience   String?
  cv           String?
  contractType ContractType   @default(FREELANCE)
  hourlyRate   Float?
  status       TeacherStatus  @default(ACTIVE)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  contacts     Contact[]
  modules      CourseModule[]
  schedules    Schedule[]
  userId       String?        @unique
  user         User?          @relation(fields: [userId], references: [id])

  @@map("teachers")
}

model Provider {
  id          String           @id @default(cuid())
  name        String
  email       String?
  phone       String?
  address     String?
  taxId       String?          @unique
  category    ProviderCategory
  description String?
  website     String?
  status      ProviderStatus   @default(ACTIVE)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  contacts    Contact[]
  materials   Material[]

  @@map("providers")
}

model Course {
  id                String           @id @default(cuid())
  title             String
  description       String?
  code              String           @unique
  level             CourseLevel
  duration          Int?
  maxStudents       Int?
  price             Float?
  isActive          Boolean          @default(true)
  startDate         DateTime?
  endDate           DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  benefits          String?
  publicDescription String?
  affiliatePrice    Float?
  hasCertificate    Boolean          @default(true)
  hasMaterials      Boolean          @default(true)
  features          String?
  callUrl           String?
  durationMonths    Int?
  durationPeriod    String?
  durationSessions  Int?
  sessionDuration   Float?
  syllabusUrl       String?
  priceUnit         String?
  paymentFrequency  String?
  materials         CourseMaterial[]
  modules           CourseModule[]
  enrollments       Enrollment[]
  payments          Payment[]
  schedules         Schedule[]

  @@map("courses")
}

model CourseModule {
  id          String   @id @default(cuid())
  title       String
  description String?
  courseId    String
  teacherId   String?
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  teacher     Teacher? @relation(fields: [teacherId], references: [id])

  @@map("course_modules")
}

model Enrollment {
  id             String           @id @default(cuid())
  studentId      String
  courseId       String
  enrollmentDate DateTime         @default(now())
  status         EnrollmentStatus @default(ENROLLED)
  progress       Float            @default(0)
  grade          Float?
  certificate    String?
  notes          String?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  course         Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student        Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId])
  @@map("enrollments")
}

model Payment {
  id            String        @id @default(cuid())
  studentId     String?
  courseId      String?
  amount        Float
  currency      String        @default("EUR")
  paymentDate   DateTime      @default(now())
  paymentMethod PaymentMethod
  reference     String?       @unique
  description   String?
  status        PaymentStatus @default(PENDING)
  dueDate       DateTime?
  paidDate      DateTime?
  invoiceNumber String?       @unique
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  course        Course?       @relation(fields: [courseId], references: [id])
  student       Student?      @relation(fields: [studentId], references: [id])

  @@map("payments")
}

model Material {
  id          String           @id @default(cuid())
  name        String
  description String?
  type        MaterialType
  quantity    Int              @default(0)
  unitPrice   Float?
  location    String?
  providerId  String?
  isAvailable Boolean          @default(true)
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  courses     CourseMaterial[]
  provider    Provider?        @relation(fields: [providerId], references: [id])

  @@map("materials")
}

model CourseMaterial {
  id         String   @id @default(cuid())
  courseId   String
  materialId String
  quantity   Int      @default(1)
  isRequired Boolean  @default(true)
  notes      String?
  course     Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  material   Material @relation(fields: [materialId], references: [id], onDelete: Cascade)

  @@unique([courseId, materialId])
  @@map("course_materials")
}

model Schedule {
  id          String    @id @default(cuid())
  courseId    String
  dayOfWeek   DayOfWeek
  startTime   DateTime
  endTime     DateTime
  classroom   String?
  isRecurring Boolean   @default(true)
  notes       String?
  teacherId   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  course      Course    @relation(fields: [courseId], references: [id], onDelete: Cascade)
  teacher     Teacher?  @relation(fields: [teacherId], references: [id])

  @@map("schedules")
}

model Contact {
  id         String          @id @default(cuid())
  name       String
  email      String?
  phone      String?
  mobile     String?
  address    String?
  company    String?
  position   String?
  category   ContactCategory
  notes      String?
  isPrimary  Boolean         @default(false)
  createdAt  DateTime        @default(now())
  updatedAt  DateTime        @updatedAt
  studentId  String?
  teacherId  String?
  providerId String?
  userId     String?
  provider   Provider?       @relation(fields: [providerId], references: [id])
  student    Student?        @relation(fields: [studentId], references: [id])
  teacher    Teacher?        @relation(fields: [teacherId], references: [id])
  user       User?           @relation(fields: [userId], references: [id])

  @@map("contacts")
}

model Software {
  id           String       @id @default(cuid())
  name         String
  version      String?
  type         SoftwareType
  license      String?
  licenseKey   String?
  expiryDate   DateTime?
  provider     String?
  description  String?
  isActive     Boolean      @default(true)
  maxUsers     Int?
  currentUsers Int          @default(0)
  url          String?
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@map("software")
}

model Notification {
  id         String               @id @default(cuid())
  title      String
  message    String
  type       NotificationType
  priority   NotificationPriority @default(MEDIUM)
  category   NotificationCategory
  isRead     Boolean              @default(false)
  targetUser String?
  targetRole UserRole?
  actionUrl  String?
  expiresAt  DateTime?
  createdAt  DateTime             @default(now())
  updatedAt  DateTime             @updatedAt
  user       User?                @relation(fields: [targetUser], references: [id])

  @@map("notifications")
}

model NotificationPreference {
  id        String               @id @default(cuid())
  userId    String
  category  NotificationCategory
  enabled   Boolean              @default(true)
  email     Boolean              @default(true)
  inApp     Boolean              @default(true)
  push      Boolean              @default(false)
  createdAt DateTime             @default(now())
  updatedAt DateTime             @updatedAt
  user      User                 @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, category])
  @@map("notification_preferences")
}

enum UserRole {
  ADMIN
  TEACHER
  STAFF
}

enum StudentStatus {
  ACTIVE
  INACTIVE
  SUSPENDED
  GRADUATED
}

enum ContractType {
  FREELANCE
  PART_TIME
  FULL_TIME
  HOURLY
}

enum TeacherStatus {
  ACTIVE
  INACTIVE
  ON_LEAVE
}

enum ProviderCategory {
  MATERIALS
  SOFTWARE
  EQUIPMENT
  SERVICES
  MAINTENANCE
  OTHER
}

enum ProviderStatus {
  ACTIVE
  INACTIVE
  BLACKLISTED
}

enum CourseLevel {
  BEGINNER
  INTERMEDIATE
  ADVANCED
  EXPERT
  PREPARACION_OPOSICIONES
}

enum EnrollmentStatus {
  ENROLLED
  IN_PROGRESS
  COMPLETED
  DROPPED
  FAILED
  PENDING
  CANCELLED
}

enum PaymentMethod {
  CASH
  BANK_TRANSFER
  CREDIT_CARD
  DEBIT_CARD
  PAYPAL
  OTHER
}

enum PaymentStatus {
  PENDING
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum MaterialType {
  BOOK
  SOFTWARE
  EQUIPMENT
  TOOL
  CONSUMABLE
  DIGITAL_RESOURCE
  OTHER
}

enum DayOfWeek {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

enum ContactCategory {
  PERSONAL
  WORK
  EMERGENCY
  ACADEMIC
  ADMINISTRATIVE
  TECHNICAL
  OTHER
}

enum SoftwareType {
  LMS
  VIDEO_CONFERENCE
  PRODUCTIVITY
  DESIGN
  PROGRAMMING
  ACCOUNTING
  OTHER
}

enum NotificationType {
  INFO
  SUCCESS
  WARNING
  ERROR
  ALERT
}

enum NotificationPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum NotificationCategory {
  PAYMENT
  COURSE
  STUDENT
  TEACHER
  SYSTEM
  SECURITY
  MAINTENANCE
}
